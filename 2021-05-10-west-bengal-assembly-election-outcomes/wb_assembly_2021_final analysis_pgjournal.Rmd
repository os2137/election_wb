---
title: 'West Bengal Assembly Election 2021: An Analysis'
author: "Onkar Singh"
date: "`r Sys.Date()`"
output:
  word_document: default
  pdf_document: default
  html_document:
    df_print: paged
categories: []
tags: []
slug: west-bengal-assembly-election-outcomes
editor_options: 
  chunk_output_type: inline
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE, 
  message = FALSE, 
  echo = FALSE, 
  results = TRUE, 
  fig.width = 10, 
  fig.height = 8, 
  out.width = "90%", 
  out.height = "90%"
)

```

```{r}
library(tidyverse)
library(readxl)
library(scales)
# theme_set(theme_light(base_size = 16))
library(ggrepel)
library(esquisse)
library(modeldata)
library(skimr)
library(showtext)  
library(patchwork)
# download "Lobster Two" and save it as "lobstertwo"
# font_add_google("Play", "play")
# font_add_google("Roboto", "roboto")
# font_add_google("Poppins", "poppins")
showtext_auto()
theme_set(theme_light())
theme_update(
  legend.text = element_text(size=12, family = "Aldine721 BT"),
  legend.title = element_text(size=12, family = "Aldine721 BT"),
  legend.position = "bottom",
  legend.justification = "center",
  
  text = element_text(family = "Aldine721 BT", size = 12, color = "black"),
  plot.title = element_text(family = "Aldine721 BT", size = 15,
                             color="#171a21"),
  plot.subtitle = element_text(family = "Aldine721 BT", size = 15, 
                                color="#1b2838"),
  plot.caption = element_text(size = 12),
  plot.title.position = "plot",
  #plot.caption.position = "plot",
  axis.text = element_text(size = 12, color = "black"),
  axis.title = element_text(size=12),
  axis.ticks = element_blank(),
  axis.line = element_line(colour = "grey50"),
  rect = element_blank(),
  panel.grid = element_line(color = "#b4aea9"),
  panel.grid.minor = element_blank(),
  panel.grid.major.x = element_blank(),
  #panel.grid.major.x = element_line(linetype="dashed"),
  #panel.grid.major.y = element_blank(),
  panel.grid.major.y = element_line(linetype="dashed"),
  plot.background = element_rect(fill = '#ffffff', color = '#ffffff') # earlier it was fill = '#fbf9f4', color = '#fbf9f4'
)

## earlier plot, title, subtile was in Roboto and tegend_text and legend_title was in play font in case we need to reverse it. 


# theme_set(ggthemes::theme_wsj(base_size = 18, base_family = "Graphik", title_family = "Graphik"))
```

```{r results = FALSE}
## Reading data

wb <- read_csv("TCPD_AE_West_Bengal_2021-5-10.csv") %>% 
  janitor::clean_names() 
```

```{r results = FALSE}
wb %>% count(party, sort = T)
```

### ABOUT THE AUTHOR

Onkar Singh holds a Master in International Affairs from Columbia University and is interested in Indian Political Affairs. Currently, he works with Accenture's Global Corporate Citizenship team as Program Management and M&E Lead. The analysis presented here is his independent effort and he confirms he is solely responsible for the consequences of this work. Onkar can be reached at os2137\@caa.columbia.edu for any suggestions or criticism of this analysis.

## METHODOLOGY

The data for the above analysis was obtained from the [Election Commission of India portal](https://eci.gov.in/) and [Trivedi Center for Political Data](https://tcpd.ashoka.edu.in/) at the Ashoka University, India. The analysis was done with the help of Microsoft Excel and R Software and its ggplot2 package for Visualization. The various reports and publications referenced below serve as a secondary source in the process of this analysis. The analysis covers each district of the West Bengal states represented in the map below and provides election results for each of the 294 assembly constituencies in West Bengal.

![Map of West Bengal: Districts](map_wb_bw.png)

## INTRODUCTION

The West Bengal Assembly election was one of the most keenly watched Assembly elections in India in 2021. One of the reasons for this interest was an unexpected rise of the Bharatiya Janata Party in a state mostly known for its contests between the Left, Congress, and the Trinamool Congress.

BJP had only 3 seats in the last Assembly election of 2016 whereas the ruling TMC had 212. BJP was never a major player in the state except during the last Parliamentary election where BJP bagged 18 of the 42 parliamentary seats. This raised very high hopes in the BJP camp and the party put all its political might in the West Bengal Legislative Assembly election concluded in May 2021 where it was pitted against the ruling TMC led by its leader Mamta Banerjee. The stakes were so high that BJP made some of its central ministers resign to contest assembly elections to bolster the party's prospects in a state traditionally considered home to non-BJP political forces.

This was coupled with the high decibel election campaign led by Prime Minister Narendra Modi, along with Home Minister Amit Shah and BJP President JP Nadda. On the other side, the two-time chief minister Mamata Banerjee led the incumbent party from the front and ran a highly successful campaign leading to her party's victory in the Assembly Election. This marked the beginning of the third term of the TMC government in the State.

Opinion and exit polls were equally divided: some predicted an edge to the ruling TMC while others gave a slight edge to the BJP. However, the final results on 2nd May 2021, put all speculations to rest with TMC winning 213 of the seats, whereas BJP managed to win only 77 seats.

The data for the above analysis was obtained from the Election Commission of India portal and Trivedi Center for Political Data at the Ashoka University, India.

# RESULTS AND DISCUSSION

## Total Number of Political Parties in the Fray

A total of 59 political parties took part in the West Bengal assembly election 2021.

## Table 1: Number of Seats Contested by Each Political Parties

```{r}
wb %>% 
  filter(party != "NOTA") %>% 
  count(party, name = "number_of_seats_contested" , sort = T) %>%
  set_names("Political Party", "No. of Contested Seats") %>% 
  flextable::flextable() %>% 
  # flextable:: set_caption("Total Number of Political Parties in the Election)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::bold(part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  # flextable::color(color = "white", part = "header") %>% 
  flextable::autofit()

# knitr::knit_exit()
# Check this for further reference on knitting a particular section
# https://community.rstudio.com/t/from-rstudio-is-it-possible-to-knit-only-part-of-an-r-markdown-document/6475

  

```

## Main Political parties by number of seats contested

```{r fig.height=6}
wb <- wb %>% 
  filter(party != "NOTA")

seats_contested <- wb%>% 
  filter(party != "IND") %>% 
  count(party, name = "number_of_seats_contested" , sort = T) %>% 
  head(8) %>% 
  mutate(party = fct_reorder(party, number_of_seats_contested)) %>% 
  ggplot(aes(y = party, x = number_of_seats_contested, fill = party))+
  geom_col(width = 0.3) +
  geom_text_repel(aes(label = number_of_seats_contested), hjust = 0.5, vjust = 1) +
  labs(title = "Total seats contested by political parties", 
              x = "Total number of seats contested", 
       y = "Political parties" ) +
  theme(legend.position = "none") +
  
  # ggthemes::theme_wsj() +
  theme(plot.title = element_text(size = 14))

seats_contested
```
Figure 2: Main Political parties by number of seats contested

Both TMC and BJP contested almost all of the seats whereas other main parties in the state CPM, Congress had an alliance with ISF, a newly formed party led by Abbas Siddiqui.

## Total number of repeat vs new candidates

```{r fig.height=5}
repeat_candidates <- wb%>% 
  filter(party != "IND") %>% 
  count(party, recontest
, name = "number_of_candidates" , sort = T) %>% 
  filter(party %in% c("BJP", "AITC", "CPM", "INC")) %>% 
  ggplot(aes(y = party, x = number_of_candidates, fill = recontest
))+
  geom_col(width = 0.3) +
  labs(title = "Total number of repeat vs new candidates", 
              x = "Total number of seats contested", 
       y = "Political parties"
       ) +
  theme(legend.position = "none") +
  
  theme(plot.title = element_text(size = 14)) +
  theme(legend.text = element_text(color ="black", size = 9), 
        legend.title = element_text(color = "tomato", size = 10), 
        legend.position =  "bottom") +
  scale_fill_discrete(name = "Recontested", labels = c("No", "Yes") ) 
  
repeat_candidates
# reference for labels title position and labels: https://www.datanovia.com/en/blog/ggplot-legend-title-position-and-labels/
```

Figure 3: Total number of repeat vs new candidates
As expected, a larger number of repeat candidates were fielded by the TMC, this could be because it had the largest number of MLAs in the outgoing assembly, and it's not common that parties replace their seating candidates. The BJP fielded the largest number of new candidates. The largest number of candidates from TMC were in the fray to defend their existing membership in the assembly. And since all other political parties had fewer MLAs in the assembly, they likely bet on the newer candidates than those who lost the election on their ticket last time.



## Total number of votes secured by each political party

```{r fig.height=5}
wb_total_percent <-  wb %>% 
  group_by(party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) 


total_votes <- wb_total_percent%>% 
  arrange(desc(total_votes)) %>% 
  head(5) %>% 
  mutate(party = fct_reorder(party, total_votes)) %>% 
  ggplot(aes(total_votes, party, fill = party)) +
  geom_col(width = 0.3, show.legend = FALSE) + 
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", CPM = "#D52C3C", INC = "#E4FC2C")) +
  scale_x_continuous(labels = scales::comma) +
  geom_text_repel(aes(label = comma(total_votes)), hjust = 0.5, vjust = 1) +
  coord_cartesian(xlim = c(0, 40000000)) +
  # ggthemes::theme_wsj() +
  labs(title = "Total number of votes secured by each political parties", 
       x = "Total number of votes", 
       y = "Political parties") +
 theme(axis.text.x = element_text(colour = "grey20", size = 9, angle = 360, hjust = 0.5, vjust = 0.5))

  
total_votes 
  
```

Figure 4: Total number of votes secured by each political party

While the ruling party TMC bagged 2.86 crores or 28.6 million votes, BJP got 2.27 crores or 22.7 million votes. The difference in votes between the two main parties is 59 lakhs or 5.9 million votes. CPM bagged 28 lakhs or 2.8 million votes, while Congress could manage to get over 17 lakhs or 1.7 million votes.

## Total percentage of votes secured by each political party

```{r fig.height=5}
wb_total_percent <- wb_total_percent%>% 
  arrange(desc(percent_votes)) %>% 
  head(10) %>% 
  mutate(percent_votes = round(percent_votes,2
                               )) 

votes_percent <- wb_total_percent %>% 
  head(5) %>% 
  mutate(party = fct_reorder(party, percent_votes)) %>% 
  ggplot(aes(percent_votes, party, fill = party)) +
  geom_col(width = 0.3, show.legend = F) +
  expand_limits(x = c(0.1, 0.7)) +
  scale_x_continuous(
                     breaks = c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7), 
label = c("10%", "20%", "30%","40%", "50%","60%", "70%")) +
                      
scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", CPM = "#D52C3C", INC = "#E4FC2C"))+
  geom_text_repel(aes(label = percent(round(percent_votes, 2))), hjust = 0.5, vjust = 1) +
  # ggthemes::theme_wsj() +
  guides(fill = guide_legend(reverse = TRUE)) +
  labs(title = "Total percentage of votes secured by main political parties",
         x = "Percent votes", 
       y = "Political parties")
  votes_percent
```

Figure 5: Total percentage of votes secured by each political party


The TMC emerged victorious with 48% of the total popular votes, while the opposition BJP got 39% of the popular votes. CPM managed to win 5% of the votes followed by Congress and Independents with 3% and 2 % of the popular votes respectively. This shows that the contest was highly polarized and bipolar between the incumbent Trinamool Congress (AITC) and the challenger Bhartiya Janata Party (BJP).

## Total number of seats secured by each political party

```{r fig.height=5}
total_seats <- wb %>% 
  filter(position == 1) %>% 
  count(party, sort = T) %>% 
  mutate(party = fct_reorder(party,n)) %>% 
  ggplot(aes(n, party,
             fill = party)) + 
  geom_col(width = 0.3, show.legend = F) +
  expand_limits(x = c(0, 250)) +
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E"))+
  geom_text_repel(aes(label = n), hjust = 0.5, vjust = 1) +
  labs(x = "Total number of seats", 
       y = "Political Party", 
       title = "Total number of seats won by political parties") +
  
  # ggthemes::theme_wsj() +
  guides(fill = guide_legend(reverse = TRUE))

total_seats 
```
Figure 6: Total number of seats secured by each political party

TMC won 213 (73% of total seats), whereas the BJP came to a distant second with 77 (26%) seats, even though it raised its stock significantly in the West Bengal Assembly from its 2016 tally of a meager 3.

```{r}
votes_percent + total_seats
```


## Total number of seats secured by each political party per region

```{r , fig.width = 10, fig.height = 5, units = "in"}
seats_by_region <- wb %>% 
  filter(position == 1) %>% 
  count(party, sub_region, sort = T) %>% 
  mutate(party = fct_reorder(party, n)) %>% 
    ggplot(aes(n, party, fill = party)) + 
    geom_col(width = 0.3, show.legend = F) +
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E")) +
  geom_text_repel(aes(label = n), color = "black", hjust = 1, vjust =0.5) +
  
  facet_wrap(~sub_region, scales = "free_y") +
  theme(strip.text = element_text(
        size = 10, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) + 
  coord_cartesian(xlim = c(0, 120)) +
  labs(title = "Number of seats won by parties in each region", 
       subtitle = "2021 assembly election", 
       x = "Number of seats won", 
        y = "Party") +
   guides(fill = guide_legend(reverse=TRUE)) 
 seats_by_region
```

Figure 7: Total number of seats secured by each political party per region

TMC won the largest proportions of seats in the Presidency (TMC: 111 vs BJP: 16) and Burdwan (TMC: 79 vs BJP: 31) divisions whereas BJP emerged as a dominant force in the Jalpaiguri division ( BJP 30 vs TMC 23).

## Seats by constituency type

```{r, fig.width=10, fig.height=5}
set.seed(124)
winner_by_const_type <- 
  
  wb %>% 
  filter(position == 1) %>% 
  count(party, constituency_type, sort = T) %>% 
  mutate(party = fct_reorder(party, n)) %>% 
    ggplot(aes(n, party, fill = party)) + 
    geom_col(width = 0.3, show.legend = F
             ) +
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E"))+
  geom_text_repel(aes(label = n), color = "black", hjust = 1) +
  facet_grid(~constituency_type ) +
   guides(fill = guide_legend(reverse=TRUE)) +
  theme(strip.text = element_text(
        size = 12, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill = "#ffffff", size=1.5, linetype="solid"
     )) +
  labs (x = "Number of seats")+
  theme(axis.text.x = element_text(colour = "grey20", size = 9, angle = 360, hjust = 0.5, vjust = 0.5)) +
  labs(x = "Party", 
       y = "Number of seats", 
       z = "Number of seats won by constituency type")
winner_by_const_type
```
Figure 8: Winner by constituency type

TMC won 82% of the General or non-reserved (168 out of 206) seats, whereas it won 53% (36 out of 68) of the SC and 56 % of the ST (9 out of 16) reserved seats. TMC has done better electorally in General seats when compared to SC and ST seats. BJP won 18% of the total General or non-reserved (18 out of 206) seats and 47% of the SC (32 out of 68) and 44 % of the ST (7 out of 16) reserved seats. The BJP has done better electorally in SC and ST seats when compared to the General seats.

```{r}
seats_by_region/winner_by_const_type
```


## Winner by margin of 5000 or less

```{r fig.height=4}
margin_5korless <- wb %>% 
  filter(position == 1) %>% 
  filter(margin <=5000) %>% 
  filter(party %in% c("BJP", "AITC")) %>% 
  count(party, sort = T) %>% 
  # mutate(party = fct_reorder(party, n)) %>% 
    ggplot(aes(n, party, fill = party)) + 
    geom_col(width =  0.3, show.legend = F) + 
  expand_limits(x = c(0, 30))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33"
                                ))+
  geom_text_repel(aes(label = n), color = "black", hjust = 0.5, vjust =1) +
  labs(
    x = "Number of seats", 
    y = "Party", 
    title = "Seats won with a margin of 5000 or less"
  )
    # ggthemes::theme_wsj()
margin_5korless

```

The total number of candidates who won by a margin of 5000 or less was 35 or around 12% of the total assembly seats. Out of the total 35, 63% or 22 were won by BJP and 37% or 13 were won by TMC. This indicates that more candidates from BJP won by a lower margin than TMC.

## Constituencies with lower voter turnout

```{r fig.height=5}
lower_turnout <- wb %>% 
  filter(position == 1) %>% 
  filter(turnout_percentage <= 60) %>% 
  mutate(constituency_name = fct_reorder(constituency_name, turnout_percentage)) %>% 
  ggplot(aes(y = constituency_name, x = turnout_percentage, fill = party)) +
  geom_col(width = 0.3) +
  scale_fill_manual(values = c( AITC = "#33FF9E")) +
  labs(title = "Constituencies with lower turnout", 
       subtitle = "all the winner candidate were from the TMC") +
# theme(legend.position = "none") +
  labs(x = "Turnout percentage", 
       y = "Constituency name") +
  theme(legend.title = element_blank())

lower_turnout
```
Figure 10: Constituencies with lower voter turnout
There were 5 constituencies with a turnout of 60 percent and below, in all these five constituencies the winning candidates were from the ruling TMC. However, since the seats with lower turnouts were just 5, this could just be a pure coincidence or some underlying factors which need to be further investigated, if lower voter turnout favored one party over the other in this state election.

## Constituencies with higher voter turnout

```{r}
higher_turnout <- wb %>% 
  filter(position == 1) %>% 
  filter(turnout_percentage >= 85) %>% 
  arrange(desc(turnout_percentage))  %>% 
  head(10) %>% 
  mutate(constituency_name = fct_reorder(constituency_name, turnout_percentage)) %>% 
  ggplot(aes(turnout_percentage, constituency_name, fill = party)) +
  geom_col(width = 0.3)  +
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E")) +
  labs(title = "Constituencies with higher voter turnout") +
  theme(legend.position = "bottom") +
  labs(x = "Turnout percentage", 
       y = "Constituency name") + 
  theme(legend.title = element_blank())
 higher_turnout 
```

Figure 11: Constituencies with higher voter turnout

There were 10 constituencies with a turnout of 85 percent and above and in these 10 constituencies seven were won by TMC, two by BJP ,and one by independents. Higher or lower voter turnout seems to be benefiting TMC. However, this could be a coincidental outcome as well, given TMC has a higher number of seats across the state when compared to BJP and these higher or lower turnout constituencies could be a reflection of the results across the state. This is something that needs to be investigated further.


## The Chief Minister's Constituency

```{r fig.height=5}
cm <- wb %>% 
  filter(constituency_name == "NANDIGRAM") %>% 
  head(3) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
  mutate(candidate = fct_reorder(candidate, votes)) %>% 
  ggplot(aes(votes, candidate, fill = party)) +
  geom_col(width = 0.3)  +
  geom_text_repel(aes(label = votes), color = "black", hjust = 0.5, vjust = 1) +
  coord_cartesian(xlim = c(0, 150000)) +
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", CPM = "#D52C3C")) +
  labs(title = "Nandigram where Chief Minister Mamata Banerjee \n lost to Suvedhu Adhikari in a very close fight", 
       subtitle = "", 
       x = "Number of votes", 
       y = "Key candiates" ) +
  theme(legend.position ="bottom") +
  theme(legend.title = element_blank())
cm
```

Figure 12: The Chief Minister’s Constituency

Chief Minster Mamta Banerjee left her traditional safe seat and challenged his one-time confidante turned rival, Sudhadu Adhikar at his home turf in Nandigram. This contest was fierce and very close in which Suvendhu Adhikari of the BJP emerged victorious with a narrow margin. Mamta Banerjee lost her seat, but she was the real winner with her party, TMC, securing two-thirds of the majority in a fiercely fought West Bengal election. Eventually, she was elected Chief Minister of West Bengal for a straight third term.

## The Gender split of Winner candidates by party

```{r fig.height= 5}
gender <- wb %>% 
  filter(position == 1) %>% 
  count(party, sex, sort = T) %>% 
  mutate(party = fct_reorder(party, n)) %>% 
    ggplot(aes(n, party, fill = party)) + 
    geom_col(width = 0.3, show.legend = F) +
  scale_x_continuous(
                     breaks = c(50, 100, 150, 200))+
  geom_text(aes(label = n), color = "black", vjust = 1, hjust = 0.5) +
  facet_wrap(~sex, scales = "free_y") +
  theme(strip.text = element_text(
        size = 12, color = "black", face = "bold"
        ),
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     ))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E")) +
   guides(fill = guide_legend(reverse=TRUE)) +
  labs(x = "Number of seats", 
       y = "Party", 
       title = "Gender distribution of seats won")
  
  # ggthemes::theme_wsj()
gender
```
Figure 13: The Gender split of Winner candidates by party

Out of the total seats won by TMC, the seats won by women were 33 or 15.5% of the total seats of 213 whereas for the BJP, it was 7 or 9% of the total seats of 77.





## Total number of seats secured by each political party by district

```{r fig.width = 20, fig.height = 15, units = "in"}

# 
wb %>% 
  filter(position == 1) %>% 
  count(party, district_name, sort = T) %>% 
  mutate(party = fct_reorder(party, n)) %>% 
    ggplot(aes(n, party, fill = party)) + 
    geom_col(size = 0.3, show.legend = F) +
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E")) +
  geom_text_repel(aes(label = n), hjust = 0.5, vjust = 1, size = 5) +
  facet_wrap(~district_name, scales = "free_y") +
  theme(strip.text = element_text(
        size = 12, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1, linetype="solid"
     )) +
  coord_cartesian(xlim = c(0, 40)) +
  labs(title = "Number of seats won by parties in each district", 
       subtitle = "2021 assembly election", 
       x = "Number of seats won", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  theme(title = element_text(size = 18))


# checkout the stuff about freeing scales
```

Out of the total 19 districts, TMC bagged more seats in 12 districts (Bardhaman, Birbhum, Hooghly, Howrah, Kolkata Corporation, Maldah, Murshidabad, North 24 Parganas, Paschim Medinipur, Purba Medinipur, South 24 Parganas, Uttar Dinajpur) whereas BJP had a bigger share of seats in only 6 districts (Bankura, Cooch Behar, Darjeeling, Jalpaiguri, Nadia, and Purulia). BJP didn't win any seats in Howrah (16), Kolkata Corporation(11), and South 24 Parganas(30) districts, whereas TMC didn't win any seats in Darjeeling(6).

##Table 2: Total number of seats secured by each political party by district


```{r}

wb %>% 
  filter(position == 1) %>% 
  count( district_name, party) %>% 
  arrange("District Name" = district_name, "Total Number of Seats" = desc(n)) %>% 
  rename("District Name" = district_name, "Total Number of Seats" = n, "Party" = party) %>% 
  flextable::flextable() %>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit()
 

```


## 1. BANKURA District: Winners per constituency and top 3 candidates

```{r}
library(tidytext) # for reorder_within function for ordering bars under facet, its important to keep scales = "free_x" within facet_wrap for reference check out https://juliasilge.com/blog/reorder-within/



wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "BANKURA") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "Bankura District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill = '#ffffff', size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")


```

## Table 2: BANKURA District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "BANKURA") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
    mutate(candidate = str_to_title(candidate)) %>% 
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))
  
  # knitr::knit_exit()
```

```{r echo = FALSE, include=FALSE}
seats_per_district <- wb %>% 
  filter(position == 1) %>% 
  count(district_name, party) 
  seats_per_district
```

```{r echo = FALSE, include=FALSE}
seats_per_district <- wb %>% 
  filter(position == 1) %>% 
  count(district_name, party) 
seats_per_district
wb%>% 
  filter(position == 1) %>% 
  count(district_name, constituency_type)
```

```{r echo = FALSE, include = FALSE}

### Bankura District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "BANKURA") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "BANKURA") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seats are reserved for the Scheduled Tribes (ST) community. Seats reserved for SC include `r reserved_seats_names_sc`, and the seats reserved for ST include `r reserved_seats_names_st` respectively.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` , and the seats won by `r second_largest_party` include `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 2. BARDHAMAN District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "BARDHAMAN") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "BARDHAMAN District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political parties") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(50000, 100000, 150000), 
label = c("50K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 7, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 3: BARDHAMAN District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "BARDHAMAN") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### BARDHAMAN District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "BARDHAMAN") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)



total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)


# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "BARDHAMAN") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 3. BIRBHUM District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "BIRBHUM") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "BIRBHUM District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 4: BIRBHUM District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "BIRBHUM") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### BIRBHUM District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "BIRBHUM") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "BIRBHUM") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seat. The seats won by `r largest_party` were `r seat_names_largest_party` and the seat won by `r second_largest_party` is `r seat_names_second_largest_party`.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 4. COOCH BEHAR District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "COOCH BEHAR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "COOCH BEHAR District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 5: COOCH BEHAR District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "COOCH BEHAR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### COOCH BEHAR District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "COOCH BEHAR") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html



# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "COOCH BEHAR") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community. The seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` , and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 5. DAKSHIN DINAJPUR District: Winners per constituency and top 3 candidates

```{r fig.height=6}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "DAKSHIN DINAJPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col(width = 0.2) +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "DAKSHIN DINAJPUR District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 6: DAKSHIN DINAJPUR District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "DAKSHIN DINAJPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### DAKSHIN DINAJPUR District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "DAKSHIN DINAJPUR") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html


# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "DAKSHIN DINAJPUR") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seat is reserved for the Scheduled Tribes (ST) community. Seats reserved for SC include `r reserved_seats_names_sc` and the seat reserved for ST include `r reserved_seats_names_st`.

Out of the total `r total_seats_count` seats in the `r district_name` district, `r largest_seats_no` seats each were won by the AITC and the BJP. The seats won by AITC were Kushmandi, Kumarganj, and Harirampur, and the seats won by BJP include Balurghat, Tapan, and Gangarampur respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 6. DARJEELING District: Winners per constituency and top 3 candidates

```{r fig.height=6}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "DARJEELING") %>%
  filter(!candidate %in% c("Tshering Lama", "DR. R.B. BHUJEL", "PEMBA TSHERING")) %>% 
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "DARJEELING District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.2) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF",  CPM = "#D52C3C", INC = "#E4FC2C")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")

```

## Table 7: DARJEELING District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "DARJEELING") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### DARJEELING District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "DARJEELING") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html



# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "DARJEELING") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seat is reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seat is reserved for the Scheduled Tribes (ST) community. Seats reserved for SC include `r reserved_seats_names_sc` and the seats reserved for ST include `r reserved_seats_names_st` respectively.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seat. The seats won by `r largest_party` were `r seat_names_largest_party` and the seat won by `r second_largest_party` was `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was inthird place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 7. HOOGHLY District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "HOOGHLY") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "HOOGHLY District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 8: HOOGHLY District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "HOOGHLY") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### HOOGHLY District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "HOOGHLY") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html


# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "HOOGHLY") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 8. HOWRAH District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "HOWRAH") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "HOWRAH District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 9: HOWRAH District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "HOWRAH") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### HOWRAH District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "HOWRAH") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "HOWRAH") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and both seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, all seats i.e. `r largest_seats_no` were won by the `r largest_party`. The seats won by `r largest_party` were `r seat_names_largest_party`.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 9. JALPAIGURI District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "JALPAIGURI") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "JALPAIGURI District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 10: JALPAIGURI District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "JALPAIGURI") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### JALPAIGURI District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "JALPAIGURI") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "JALPAIGURI") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seats are reserved for the Scheduled Tribes (ST) community. The seats reserved for SC include `r reserved_seats_names_sc`, and the seats reserved for ST include `r reserved_seats_names_st` respectively.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 10. KOLKATA CORPORATION District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "KOLKATA CORPORATION") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "KOLKATA CORPORATION District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 11: KOLKATA CORPORATION District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "KOLKATA CORPORATION") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### KOLKATA CORPORATION District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "KOLKATA CORPORATION") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)


# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html


# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "KOLKATA CORPORATION") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies.

Out of the total `r total_seats_count` seats in the `r district_name` district, all seats i.e. `r largest_seats_no` were won by the `r largest_party`. The seats won by `r largest_party` are `r seat_names_largest_party`.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 11. MALDAH District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "MALDAH") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "MALDAH District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 12: MALDAH District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "MALDAH") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### MALDAH District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "MALDAH") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html



# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "MALDAH") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seat is reserved for the Scheduled Tribes (ST) community. The seats reserved for SC include `r reserved_seats_names_sc` and the seat reserved for ST include `r reserved_seats_names_st`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was at the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) in the total votes in the district.

## 12. MURSHIDABAD District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "MURSHIDABAD") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "MURSHIDABAD District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 13: MURSHIDABAD District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "MURSHIDABAD") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))
```

```{r echo = FALSE, include = FALSE}

### MURSHIDABAD District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "MURSHIDABAD") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html


# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "MURSHIDABAD") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community. The seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 13. NADIA District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "NADIA") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "NADIA District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(50000, 100000, 150000), 
label = c("50K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 7, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 14: NADIA District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "NADIA") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### NADIA District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "NADIA") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html


# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "NADIA") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community . Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 14. NORTH 24 PARGANAS District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "NORTH 24 PARGANAS") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "NORTH 24 PARGANAS District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 75000, 150000), 
label = c("25K", "75K", "150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 7, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 15: NORTH 24 PARGANAS District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "NORTH 24 PARGANAS") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### NORTH 24 PARGANAS District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "NORTH 24 PARGANAS") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "NORTH 24 PARGANAS") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seat is reserved for the Scheduled Tribes (ST) community. The seats reserved for SC include `r reserved_seats_names_sc` and the seat reserved for ST include `r reserved_seats_names_st`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 15. PASCHIM MEDINIPUR District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "PASCHIM MEDINIPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "PASCHIM MEDINIPUR District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 75000, 150000), 
label = c("25K", "75K", "150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 16: PASCHIM MEDINIPUR District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "PASCHIM MEDINIPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
  select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
  flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### PASCHIM MEDINIPUR District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "PASCHIM MEDINIPUR") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "PASCHIM MEDINIPUR") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seats are reserved for the Scheduled Tribes (ST) community. The seats reserved for SC include `r reserved_seats_names_sc` ,and the seats reserved for ST include `r reserved_seats_names_st` respectively.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 16. PURBA MEDINIPUR District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "PURBA MEDINIPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "PURBA MEDINIPUR District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 17: PURBA MEDINIPUR District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "PURBA MEDINIPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### PURBA MEDINIPUR District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "PURBA MEDINIPUR") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)


# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "PURBA MEDINIPUR") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and both seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` were `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was at the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) in the total votes in the district.

## 17. PURULIA District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "PURULIA") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "PURULIA District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 18: PURULIA District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "PURULIA") %>%
   group_by(party, constituency_name) %>%   arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### PURULIA District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "PURULIA") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)


# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html

# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "PURULIA") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies out of which `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community whereas `r reserved_seats_no_st` seats are reserved for the Scheduled Tribes (ST) community. Seats reserved for SC include `r reserved_seats_names_sc` and the seats reserved for ST include `r reserved_seats_names_st` respectively.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` include `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 18. SOUTH 24 PARGANAS District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "SOUTH 24 PARGANAS") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "SOUTH 24 PARGANAS District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 75000, 150000), 
label = c("25K", "75K", "150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 7, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 19: SOUTH 24 PARGANAS District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "SOUTH 24 PARGANAS") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### SOUTH 24 PARGANAS District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "SOUTH 24 PARGANAS") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)


# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html



# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "SOUTH 24 PARGANAS") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and all `r reserved_seats_no_sc` seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seat. The seats won by `r largest_party` were `r seat_names_largest_party` and the seats won by `r second_largest_party` include `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## 19. UTTAR DINAJPUR District: Winners per constituency and top 3 candidates

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "UTTAR DINAJPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>%
  # mutate(constituency_name = as.factor(constituency_name),
  #        party= reorder_within(party, votes, constituency_name)) %>%
  ggplot(aes(votes, party, fill = party)) +
  geom_col() +
  facet_wrap(~constituency_name, scales = "free_y") +
  
  labs(title = "UTTAR DINAJPUR District:First three candiates in each seat",
       subtitle = "Party with highest votes win that seat", 
       x = "Number of votes secured", 
        y = "Political party") +
   guides(fill = guide_legend(reverse=TRUE)) +
  geom_col(size = 0.3) +
  
 scale_x_continuous(
                     breaks = c(25000, 50000, 75000, 100000, 150000), 
label = c("25K", "50K", "75K", "100K","150K")) +
  expand_limits(x = c(10000, 150000))+
  scale_fill_manual(values = c( AITC = "#33FF9E", BJP = "#FF8F33", IND = "#33ADFF", RSSCMJP = "#092B4E", CPM = "#D52C3C", INC = "#E4FC2C",  AIFB = "#1a6600", RSP = "#664d00")) +
  geom_text_repel(aes(label = votes_k_nice_label ), hjust = 0.5, vjust = 1, size = 3) +
    theme(strip.text = element_text(
        size = 9, color = "black", face = "bold"
        ), 
        strip.background = element_rect(
     color="black", fill="#ffffff", size=1.5, linetype="solid"
     )) +
  theme(legend.position = "none")
```

## Table 20: UTTAR DINAJPUR District Election Results: Top 3 Candidates by Votes in Each Constituency

```{r}
wb %>% 
  filter(position %in% c(1,2,3)) %>% 
  filter(district_name == "UTTAR DINAJPUR") %>%
  group_by(party, constituency_name) %>% 
  arrange(desc(votes)) %>% 
  ungroup() %>% 
  mutate(votes_k = round(votes/1000,0)) %>% 
  mutate(votes_k_nice_label = paste0(votes_k,"K")) %>%
  mutate(party = fct_reorder(party, votes)) %>% 
  mutate(candidate = str_to_title(candidate)) %>% 
   select(constituency_name,constituency_type, party, candidate, position, votes,  margin) %>%
  arrange(constituency_name) %>% 
  set_names(c("Constituency", "Type", "Party", "Candidate", "Position", "Votes", "Margin")) %>% 
  
   flextable::flextable() %>% 
  # flextable:: set_caption("Winners per constituency and top 3 candidates)")%>% 
  flextable::border_outer() %>% 
  flextable::border_inner() %>% 
  # flextable::bg(bg = "#ECE7FF") %>% 
  # flextable::bg(bg = "#7E00FF", part = "header") %>% 
  flextable::font(fontname = "Times New Roman", part = "all") %>% 
  flextable::fontsize(size = 12, part = "header") %>% 
  flextable::fontsize(size =11) %>% 
  flextable::color(color = "black", part = "header") %>% 
  flextable::bold(part = "header"
                  ) %>% 
  flextable::colformat_double(digits = 0) %>% 
  flextable::autofit() %>% 
  flextable:: width(j = 1:7, width = c(1.5,0.8,1,1.5,0.9,1,0.9))

```

```{r echo = FALSE, include = FALSE}

### UTTAR DINAJPUR District Analysis
total_seats <- wb %>% 
  filter(position == 1) %>% 
  filter(district_name == "UTTAR DINAJPUR") 

district_name <- total_seats %>% 
  mutate(district_name =           str_to_title(district_name)) %>% 
  distinct(district_name) %>% 
  pull(district_name)

reserved_seats_no <- total_seats %>% 
  filter(constituency_type %in% c("SC", "ST")) %>% 
  count(constituency_type) %>% 
  summarize(total_reserved_seats = sum(n)) %>% 
  pull(total_reserved_seats)

reserved_seats_no_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>% 
  count(constituency_type) %>% 
  pull(n)

reserved_seats_no_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>% 
  count(constituency_type) %>% 
  pull(n)

  
reserved_seats_names_sc <- total_seats %>% 
  filter(constituency_type %in% c("SC")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

reserved_seats_names_st <- total_seats %>% 
  filter(constituency_type %in% c("ST")) %>%
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

total_seats_count <- total_seats %>% 
  nrow()

seat_split <- total_seats %>% 
    count(party, sort = T) 

largest_seats_no <- seat_split %>% 
  summarize(max = max(n)) %>% 
  pull



largest_party <- seat_split %>% 
  filter(n == max(n)) %>% 
  pull(party)



second_largest_seats_no <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(n)

  
second_largest_party <- seat_split %>% 
  slice_max(n, n = 2) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

seat_names_second_largest_party <- total_seats %>% 
  filter(party %in% second_largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

seat_names_largest_party <- total_seats %>% 
  filter(party %in% largest_party) %>% 
  mutate(constituency_name = str_to_title(constituency_name)) %>% 
  pull(constituency_name)

# reference for slicing the new tidyverse addtion in place of topn slicing https://dplyr.tidyverse.org/reference/slice.html


# Total  number of votes secured by parties in each district
options(scipen = 100)
 wb_total_percent <-  wb %>% 
  # filter(position %in% c(1,2,3)) %>% 
  # filter(district_name == "BANKURA") %>% 
  group_by(district_name, party) %>% 
  summarize(total_votes = sum(votes)) %>% 
  mutate(percent_votes = total_votes/sum(total_votes)) %>% 
  arrange(district_name, desc(total_votes))

 wb_total_percent_dist<- wb_total_percent %>% 
  filter (district_name == "UTTAR DINAJPUR") 
   
   total_votes_polled <- wb_total_percent_dist %>% 
   summarize(district_total_votes = sum(total_votes)) %>% 
   pull(district_total_votes)


largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(total_votes)

second_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(total_votes)

third_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(total_votes)

fourth_largest_votes_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(total_votes)

largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(party)

second_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(party)

third_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(party)

fourth_largest_party_dist <- wb_total_percent_dist %>%
 slice_max(total_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(party)



largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 1L) %>% 
  pull(percent_votes)

second_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 2L) %>% 
  pull(percent_votes)


third_largest_percent_dist <- wb_total_percent_dist %>%
slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 3L) %>% 
  pull(percent_votes)

fourth_largest_percent_dist <- wb_total_percent_dist %>%
 slice_max(percent_votes, n = 4) %>% 
  filter(row_number() == 4L) %>% 
  pull(percent_votes)

```

The district of `r district_name` has a total of `r total_seats_count` legislative constituencies. The district has `r reserved_seats_no` reserved constituencies and both seats are reserved for the Scheduled Castes (SC) community. Seats reserved for SC include `r reserved_seats_names_sc`.

Out of the total `r total_seats_count` seats in the `r district_name` district, the largest number of seats i.e. `r largest_seats_no` were won by the `r largest_party` while the `r second_largest_party` won `r second_largest_seats_no` seats. The seats won by `r largest_party` were `r seat_names_largest_party`, and the seats won by `r second_largest_party` include `r seat_names_second_largest_party` respectively.

Out of the total polled votes of `r total_votes_polled`, `r largest_party_dist` secured a total of `r largest_votes_dist` (`r paste0(round(largest_percent_dist, 2)*100, "%")`) votes while the `r second_largest_party_dist` secured `r second_largest_votes_dist` (`r paste0(round(second_largest_percent_dist, 2)*100, "%")`) of the votes. The `r third_largest_party_dist` with a vote share of `r third_largest_votes_dist` (`r paste0(round(third_largest_percent_dist, 2)*100, "%")`) was in third place, while the `r fourth_largest_party_dist` was in the fourth position after securing `r fourth_largest_votes_dist` (`r paste0(round(fourth_largest_percent_dist, 2)*100, "%")`) of the total votes in the district.

## CONCLUSION

What lessons Bengal election provides to the country remains to be seen, but the State and Central Government's handling of the second wave of Covid19 crisis (in which many Indians lost lives) and associated social and economic crisis, has kept the political battle open for the UP election 2022 and the General election 2024. It has also infused fresh energy in opposition parties to challenge the election machinery and public image of Prime Minister Narendra Modi which has taken a beating in surveys conducted in recent months. With the global and national uncertainties looming large due to the Covid19 crisis and a prediction of the third wave of the virus in the country, governments both at the state and the central level need to do much more than business as usual to win the trust of the people.

## References

Chaturvedi, R. M. (2021). *ET Analysis: How TMC beat BJP at its own game in West Bengal elections*. E**conomic Times.** Retrieved from [<https://m.economictimes.com/news/elections/assembly-elections/west-bengal/et-analysis-tmc-beat-bjp-at-its-own-game-turned-around-saffron-poll-planks-for-its-own-gains/amp_articleshow/82383821.cms>](https://m.economictimes.com/news/elections/assembly-elections/west-bengal/et-analysis-tmc-beat-bjp-at-its-own-game-turned-around-saffron-poll-planks-for-its-own-gains/amp_articleshow/82383821.cms){.uri} on May 4.

Ghatak, M., & Maitra, P. (2021). *2021 West Bengal Assembly election: Did the Covid-19 surge matter?* **Ideas for India**. Retrieved from [<https://www.ideasforindia.in/topics/governance/2021-west-bengal-assembly-election-did-the-covid-19-surge-matter.html>](https://www.ideasforindia.in/topics/governance/2021-west-bengal-assembly-election-did-the-covid-19-surge-matter.html){.uri} on May 12.

Tiwari, A. (2021). *In Charts: How Mamata Banerjee Scripted A Record Win In West Bengal.* . **BloombergQuint**. Retrieved from [<https://www.bloombergquint.com/politics/how-mamata-banerjee-scripted-a-record-win-in-west-bengal-election-results-2021-in-charts>](https://www.bloombergquint.com/politics/how-mamata-banerjee-scripted-a-record-win-in-west-bengal-election-results-2021-in-charts){.uri} on May 6.

Iyengar, P. (2021). *Statistical Afternotes: TMC May Have Won Bengal, but BJP Did Not Do Badly*. **The Wire**. Retrieved from [<https://thewire.in/politics/statistical-afternotes-tmc-may-have-won-bengal-but-bjp-did-not-do-badly>](https://thewire.in/politics/statistical-afternotes-tmc-may-have-won-bengal-but-bjp-did-not-do-badly){.uri} on May 7.

Kishore, R., & Jha, A. (2021). *WEST BENGAL ASSEMBLY ELECTION 3 crucial takeaways from Bengal results*. **Hindustan Times.** Retrieved from ([<https://www.hindustantimes.com/elections/west-bengal-assembly-election/3-crucial-takeaways-from-bengal-results-101620086556255.html>]https://www.hindustantimes.com/elections/west-bengal-assembly-election/3-crucial-takeaways-from-bengal-results-101620086556255.html){.uri} on May 4.

Bhattacharya, A. (2021). *Why did the BJP lose Bengal 2021?* **India Today.** Retrieved from [<https://www.indiatoday.in/news-analysis/story/why-did-bjp-lose-bengal-elections-2021-1798260-2021-05-03>](https://www.indiatoday.in/news-analysis/story/why-did-bjp-lose-bengal-elections-2021-1798260-2021-05-03){.uri} on May 5.

Dasgupta, S. (2021). *Lessons learnt The results of the West Bengal assembly elections deserve a close analysis*. **The Telegraph.** Retrieved from [<https://www.telegraphindia.com/opinion/the-results-of-the-west-bengal-assembly-elections-deserve-a-close-analysis/cid/1815369>](https://www.telegraphindia.com/opinion/the-results-of-the-west-bengal-assembly-elections-deserve-a-close-analysis/cid/1815369){.uri} on May 3.
